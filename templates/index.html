<!DOCTYPE html>
<html>
  <head>
    <title>Editor de Texto em Tempo Real</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.1.3/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  </head>
  <body>
    <textarea id="editor" rows="10" cols="50"></textarea>
    <div class="cursor" id="cursor-box"></div>

    <script type="text/javascript">
      var socket = io.connect("http://localhost:5000");
      var cursorBox = $("#cursor-box");

      socket.on("connect", function () {
        console.log("Conectado com sucesso!");
        socket.emit("get_text");
      });

      socket.on("text_update", function (data) {
        document.getElementById("editor").value = data.text;
      });

      $("#editor").on("input", function () {
        var text = $(this).val();
        socket.emit("text_update", { text: text });
      });

      $(document).on("mousemove", function (event) {
        var editor = $("#editor");
        var editorPosition = editor.offset();
        var cursorPosition = {
          x: event.pageX - editorPosition.left,
          y: event.pageY - editorPosition.top,
        };
        socket.emit("cursor_position", cursorPosition);
      });

      socket.on("all_cursor_positions", function (cursorPositions) {
        cursorBox.hide();
        for (var socketId in cursorPositions) {
          if (cursorPositions.hasOwnProperty(socketId)) {
            var cursorPosition = cursorPositions[socketId];
            showCursorPosition(socketId, cursorPosition);
          }
        }
      });

      function showCursorPosition(socketId, cursorPosition) {
        if (socketId !== socket.id) {
          // Identificação visual do cursor de outros usuários
          cursorBox.css({
            left: cursorPosition.x + "px",
            top: cursorPosition.y + "px",
          });
          cursorBox.show();
        }
      }
    </script>

    <style>
      .cursor {
        position: absolute;
        width: 2px;
        height: 20px;
        background-color: red;
      }
    </style>
  </body>
</html>
